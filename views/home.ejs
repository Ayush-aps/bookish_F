<%- include('partials/header') %>
  <!-- hero section  -->
  <section class="hero-section relative py-16 md:py-24 -mt-12 flex items-center">
    <div class="container mx-auto px-4 relative z-10">
      <div class="flex flex-col md:flex-row items-center">
        <div class="md:w-1/2 md:pr-8">
          <span
            class="inline-block px-4 py-1 rounded-full bg-primary bg-opacity-20 text-light font-medium text-sm mb-4 backdrop-blur-sm">India's
            Favorite Book Marketplace</span>
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-4 leading-tight drop-shadow-lg">
            Discover Your Next <span class="text-primary">Favorite</span> Book
          </h1>
          <p class="text-lg md:text-xl text-white mb-8 max-w-xl drop-shadow-lg">
            Browse thousands of books, from bestsellers to rare finds, all at your fingertips.
          </p>
          <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-8">
            <a href="/buyer/browse"
              class="bg-dark text-white px-8 py-4 rounded-lg text-center hover:bg-opacity-90 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg cursor-pointer inline-block">
              <i class="fas fa-book-open mr-2"></i> Browse Books
            </a>
            <a href="/auth/register?role=seller"
              class="bg-white text-dark px-8 py-4 rounded-lg text-center border border-dark hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
              <i class="fas fa-store mr-2"></i> Become a Seller
            </a>
          </div>
          <div class="flex items-center space-x-6 text-white text-sm">
            <div class="flex items-center">
              <i class="fas fa-check-circle text-primary mr-2"></i>
              <span>Free shipping over ₹499</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-check-circle text-primary mr-2"></i>
              <span>Secure payment</span>
            </div>
          </div>

        </div>
      </div>
  </section>

  <style>
    .hero-section {
      min-height: 600px;
    }

    .hero-section::before {
      content: "";
      position: absolute;
      inset: 0;
      background: url("https://images.csmonitor.com/csm/2020/12/1112756_1_1209-best-2020-fiction_standard.jpg?alias=standard_900x600") center/cover no-repeat;
      filter: brightness(0.4);
      z-index: 1;
    }

    .hero-section::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.5));
      z-index: 2;
    }

    .text-shadow-strong {
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }

    .drop-shadow-lg {
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
    }

    .drop-shadow-sm {
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    .book-card {
      flex: 0 0 auto;
      margin: 0 8px;
      border-radius: 8px;
      background-color: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      width: auto;
      max-width: 180px;
    }

    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .book-image-container {
      position: relative;
      width: 100%;
      padding-top: 150%;
      /* This creates a 2:3 aspect ratio common for book covers */
      overflow: hidden;
    }

    .book-cover {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      /* This ensures the image covers the container while maintaining aspect ratio */
    }

    .used-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 0.65rem;
      padding: 4px 8px;
      border-radius: 999px;
      background-color: #FEF3C7;
      color: #92400E;
      z-index: 2;
      font-weight: 600;
    }

    .book-info {
      padding: 0.75rem;
      text-align: left;
    }

    .book-title {
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      line-height: 1.2;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      height: auto;
      min-height: 2.2em;
      color: #333;
    }

    .book-author {
      font-size: 0.8rem;
      color: #3182CE;
      margin-bottom: 0.5rem;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .price-container {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .current-price {
      font-weight: 700;
      font-size: 0.9rem;
      margin-right: 0.25rem;
    }

    .original-price {
      color: #777;
      text-decoration: line-through;
      font-size: 0.75rem;
      margin-right: 0.25rem;
    }

    .discount-text {
      color: #A4B465;
      font-weight: 600;
      font-size: 0.7rem;
    }

    .action-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.5rem;
    }

    .add-bag-btn {
      background-color: #333;
      color: white;
      padding: 0.4rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .add-bag-btn:hover {
      background-color: #222;
    }

    .wishlist-btn {
      background: none;
      border: none;
      color: #777;
      cursor: pointer;
      font-size: 1rem;
      padding: 0.25rem;
      transition: all 0.2s;
    }

    .wishlist-btn:hover {
      color: #f56565;
    }

    .book-month-section {
      background: linear-gradient(to right, #FEFAE0, #FFF);
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    .book-month-section::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: 30%;
      background: linear-gradient(to left, #A4B465, transparent);
      opacity: 0.2;
      z-index: 1;
    }

    .book-month-badge {
      background-color: #A4B465;
      color: #fff;
      font-weight: 700;
      font-size: 0.75rem;
      text-transform: uppercase;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      display: inline-block;
      margin-bottom: 0.75rem;
      letter-spacing: 0.05em;
    }

    .book-month-title {
      font-size: 1.75rem;
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: 0.75rem;
      color: #333;
    }

    .book-month-author {
      font-size: 1rem;
      color: #3182CE;
      margin-bottom: 1.25rem;
      font-weight: 600;
    }

    .book-month-description {
      font-size: 1rem;
      line-height: 1.5;
      color: #4B5563;
      margin-bottom: 1.5rem;
    }

    .book-month-cover {
      height: auto;
      max-height: 360px;
      width: auto;
      max-width: 100%;
      object-fit: contain;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      border-radius: 4px;
    }

    .book-month-price {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 0.5rem;
    }

    .book-month-strikethrough {
      color: #777;
      text-decoration: line-through;
      font-size: 1.1rem;
      margin-left: 0.5rem;
      font-weight: 400;
    }

    .book-month-discount {
      background-color: #A4B465;
      color: white;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
      margin-left: 0.5rem;
    }

    .book-month-button {
      background-color: #333;
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      font-size: 0.9rem;
      text-transform: uppercase;
      display: inline-block;
      transition: all 0.3s;
    }

    .book-month-button:hover {
      background-color: #000;
      transform: translateY(-2px);
    }

    /* Additional carousel styling */
    .modern-carousel {
      position: relative;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 10px 0;
    }

    .carousel-slide {
      transition: transform 0.3s ease, opacity 0.3s ease;
      opacity: 0.7;
    }

    .carousel-slide.active {
      opacity: 1;
    }

    .book-card-container {
      transform: scale(0.95);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      height: 100%;
    }

    .carousel-slide.active .book-card-container {
      transform: scale(1);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .carousel-btn {
      opacity: 0.7;
      transition: all 0.3s ease;
    }

    .carousel-btn:hover {
      opacity: 1;
      transform: translateY(-50%) scale(1.1);
    }

    .carousel-dots {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin-top: 15px;
    }

    .carousel-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #ccc;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .carousel-dot.active {
      background-color: #A4B465;
      width: 20px;
      border-radius: 10px;
    }

    @media (max-width: 768px) {
      .carousel-btn {
        width: 36px;
        height: 36px;
      }
    }
  </style>

  <!-- Book of the Month Section -->
  <section class="py-12 bg-white">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">Book of the Month</h2>
      </div>

      <div class="book-month-section p-6 md:p-8">
        <div class="flex flex-col md:flex-row gap-8 relative z-10">
          <div class="md:w-2/3">
            <span class="book-month-badge">Editor's Choice</span>
            <h3 class="book-month-title">The Silent Patient</h3>
            <p class="book-month-author">Alex Michaelides</p>
            <p class="book-month-description">
              Alicia Berenson's life is seemingly perfect. A famous painter married to an in-demand fashion
              photographer, she lives in a grand house overlooking a park in one of London's most desirable areas. One
              evening, her husband Gabriel returns home late from a fashion shoot, and Alicia shoots him five times in
              the face, and then never speaks another word.
            </p>
            <div class="flex items-center mb-4">
              <span class="book-month-price">₹499</span>
              <span class="book-month-strikethrough">₹799</span>
              <span class="book-month-discount">38% OFF</span>
            </div>
            <a href="/buyer/book/silent-patient" class="book-month-button">
              Get This Book
            </a>
          </div>
          <div class="md:w-1/3 flex justify-center">
            <img src="https://m.media-amazon.com/images/I/81JJPDNlxSL._AC_UF1000,1000_QL80_.jpg"
              alt="The Silent Patient" class="book-month-cover">
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Books Section -->
  <section class="py-12 bg-light">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">Featured Books</h2>
        <a href="/buyer/browse" class="text-dark hover:text-primary">View All <i
            class="fas fa-arrow-right ml-1"></i></a>
      </div>

      <!-- Modern Carousel -->
      <div class="relative modern-carousel" id="featured-carousel">
        <div class="overflow-hidden rounded-lg">
          <div class="flex transition-transform duration-500 ease-in-out" id="carousel-inner">
            <% featuredBooks.forEach((book, index)=> { %>
              <div class="carousel-slide w-full md:w-1/4 flex-shrink-0 p-3 <%= index === 0 ? 'active' : '' %>">
                <div
                  class="bg-white rounded-lg shadow-md overflow-hidden h-full relative book-card-container transition-all duration-300">
                  <a href="/buyer/book/<%= book._id %>">
                    <div class="book-image-container">
                      <img src="<%= book.coverImage %>" alt="<%= book.title %>" class="book-cover">
                      <% if (book.condition==='used' ) { %>
                        <span class="used-badge">Used</span>
                        <% } %>
                    </div>
                  </a>
                  <div class="book-info">
                    <h3 class="book-title">
                      <%= book.title %>
                    </h3>
                    <p class="book-author">
                      <%= book.author %>
                    </p>
                    <div class="price-container">
                      <span class="current-price">₹<%= book.discountPrice || book.price %></span>
                      <% if (book.discountPrice && book.discountPrice < book.price) { %>
                        <span class="original-price">₹<%= book.price %></span>
                        <span class="discount-text">(<%= Math.round((book.price - book.discountPrice) / book.price *
                            100) %>%)</span>
                        <% } %>
                    </div>
                    <div class="action-buttons">
                      <button class="add-bag-btn">Add</button>
                      <button class="wishlist-btn"><i class="far fa-heart"></i></button>
                    </div>
                  </div>
                </div>
              </div>
              <% }) %>
          </div>
        </div>

        <!-- Modern navigation buttons -->
        <button
          class="carousel-btn prev-btn absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 backdrop-blur-sm rounded-full w-10 h-10 shadow-lg flex items-center justify-center z-10 transition-all duration-300 hover:bg-primary hover:text-dark"
          id="prev-btn">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button
          class="carousel-btn next-btn absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-80 backdrop-blur-sm rounded-full w-10 h-10 shadow-lg flex items-center justify-center z-10 transition-all duration-300 hover:bg-primary hover:text-dark"
          id="next-btn">
          <i class="fas fa-chevron-right"></i>
        </button>

        <!-- Pagination dots -->
        <div class="carousel-dots flex justify-center mt-4" id="carousel-dots"></div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="py-12 bg-white">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-12">Why Choose Bookish?</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="text-center p-6 bg-light rounded-lg shadow-sm">
          <div class="bg-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-book text-2xl text-dark"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Vast Collection</h3>
          <p class="text-gray-600">Explore thousands of books across various genres, from bestsellers to rare finds.</p>
        </div>
        <div class="text-center p-6 bg-light rounded-lg shadow-sm">
          <div class="bg-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-hand-holding-usd text-2xl text-dark"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Second-Hand Marketplace</h3>
          <p class="text-gray-600">Buy and sell used books at affordable prices, giving books a second life.</p>
        </div>
        <div class="text-center p-6 bg-light rounded-lg shadow-sm">
          <div class="bg-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-video text-2xl text-dark"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Video Reviews</h3>
          <p class="text-gray-600">Watch video reviews and recommendations from fellow book lovers.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- New Arrivals Section -->
  <section class="py-12 bg-light">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">New Arrivals</h2>
        <a href="/buyer/browse?sort=newest" class="text-dark hover:text-primary">View All <i
            class="fas fa-arrow-right ml-1"></i></a>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-6">
        <% newArrivals.slice(0, 6).forEach(book=> { %>
          <div class="bg-white rounded-lg shadow-md overflow-hidden h-full relative book-card mx-0">
            <a href="/buyer/book/<%= book._id %>">
              <div class="book-image-container">
                <img src="<%= book.coverImage %>" alt="<%= book.title %>" class="book-cover">
                <% if (book.condition==='used' ) { %>
                  <span class="used-badge">Used</span>
                  <% } %>
              </div>
            </a>
            <div class="book-info">
              <h3 class="book-title">
                <%= book.title %>
              </h3>
              <p class="book-author">
                <%= book.author %>
              </p>
              <div class="price-container">
                <span class="current-price">₹<%= book.discountPrice || book.price %></span>
                <% if (book.discountPrice && book.discountPrice < book.price) { %>
                  <span class="original-price">₹<%= book.price %></span>
                  <span class="discount-text">(<%= Math.round((book.price - book.discountPrice) / book.price * 100) %>
                      %)</span>
                  <% } %>
              </div>
              <div class="action-buttons">
                <button class="add-bag-btn">Add</button>
                <button class="wishlist-btn"><i class="far fa-heart"></i></button>
              </div>
            </div>
          </div>
          <% }) %>
      </div>
    </div>
  </section>

  <!-- Trending Books Section -->
  <section class="py-12 bg-white">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">Trending Now</h2>
        <a href="/buyer/browse?sort=rating" class="text-dark hover:text-primary">View All <i
            class="fas fa-arrow-right ml-1"></i></a>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-6">
        <% trendingBooks.slice(0, 6).forEach(book=> { %>
          <div class="bg-white rounded-lg shadow-md overflow-hidden h-full relative book-card mx-0">
            <a href="/buyer/book/<%= book._id %>">
              <div class="book-image-container">
                <img src="<%= book.coverImage %>" alt="<%= book.title %>" class="book-cover">
                <% if (book.condition==='used' ) { %>
                  <span class="used-badge">Used</span>
                  <% } %>
              </div>
            </a>
            <div class="book-info">
              <h3 class="book-title">
                <%= book.title %>
              </h3>
              <p class="book-author">
                <%= book.author %>
              </p>
              <div class="price-container">
                <span class="current-price">₹<%= book.discountPrice || book.price %></span>
                <% if (book.discountPrice && book.discountPrice < book.price) { %>
                  <span class="original-price">₹<%= book.price %></span>
                  <span class="discount-text">(<%= Math.round((book.price - book.discountPrice) / book.price * 100) %>
                      %)</span>
                  <% } %>
              </div>
              <div class="action-buttons">
                <button class="add-bag-btn">Add</button>
                <button class="wishlist-btn"><i class="far fa-heart"></i></button>
              </div>
            </div>
          </div>
          <% }) %>
      </div>
    </div>
  </section>

  <!-- Testimonials Section -->
  <section class="py-12 bg-light">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-12">What Our Customers Say</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="bg-white p-6 rounded-lg shadow-md">
          <div class="flex items-center mb-4">
            <img src="/img/testimonials/user1.jpg" alt="User" class="w-12 h-12 rounded-full mr-4">
            <div>
              <h4 class="font-semibold">Rahul Sharma</h4>
              <div class="flex">
                <% for(let i=0; i < 5; i++) { %>
                  <i class="fas fa-star <%= i < 5 ? 'text-yellow-400' : 'text-gray-300' %> text-sm"></i>
                  <% } %>
              </div>
            </div>
          </div>
          <p class="text-gray-600">"I love the second-hand marketplace feature! Found some rare books at amazing prices.
            The condition details were accurate and shipping was prompt."</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <div class="flex items-center mb-4">
            <img src="/img/testimonials/user2.jpeg" alt="User" class="w-12 h-12 rounded-full mr-4">
            <div>
              <h4 class="font-semibold">Priya Patel</h4>
              <div class="flex">
                <% for(let i=0; i < 5; i++) { %>
                  <i class="fas fa-star <%= i < 4 ? 'text-yellow-400' : 'text-gray-300' %> text-sm"></i>
                  <% } %>
              </div>
            </div>
          </div>
          <p class="text-gray-600">"The video reviews helped me choose the perfect book for my book club. The
            recommendations are spot on and I've discovered many new authors."</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <div class="flex items-center mb-4">
            <img src="/img/testimonials/user3.jpg" alt="User" class="w-12 h-12 rounded-full mr-4">
            <div>
              <h4 class="font-semibold">Amit Kumar</h4>
              <div class="flex">
                <% for(let i=0; i < 5; i++) { %>
                  <i class="fas fa-star <%= i < 5 ? 'text-yellow-400' : 'text-gray-300' %> text-sm"></i>
                  <% } %>
              </div>
            </div>
          </div>
          <p class="text-gray-600">"As a seller, I find the platform very user-friendly. The analytics dashboard helps
            me track my sales and understand customer preferences."</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Call to Action -->
  <section class="py-16 bg-primary relative">
    <!-- Decorative quote marks -->
    <div class="absolute top-6 left-1/2 transform -translate-x-1/2 opacity-10">
      <svg width="120" height="120" viewBox="0 0 24 24" fill="#000">
        <path d="M6 17h3l2-4V7H5v6h3l-2 4zm8 0h3l2-4V7h-6v6h3l-2 4z" />
      </svg>
    </div>

    <div class="container mx-auto px-4 text-center relative z-10">
      <blockquote class="text-xl md:text-2xl italic text-dark mb-8 max-w-3xl mx-auto">
        "A reader lives a thousand lives before he dies. The man who never reads lives only one."
        <footer class="text-base font-semibold mt-2">— George R.R. Martin</footer>
      </blockquote>

      <h2 class="text-3xl md:text-4xl font-bold text-dark mb-4">Ready to Start Your Journey?</h2>
      <p class="text-lg text-dark mb-8">Join thousands of book lovers on Bookish today.</p>

      <div class="inline-flex items-center justify-center p-1 bg-white bg-opacity-30 backdrop-blur-sm rounded-lg">
        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 p-2">
          <a href="/buyer/browse"
            class="bg-dark text-white px-8 py-4 rounded-md hover:bg-opacity-90 transition transform hover:-translate-y-1">Browse
            Books</a>
          <a href="/auth/register"
            class="bg-white text-dark px-8 py-4 rounded-md border border-dark hover:bg-gray-100 transition transform hover:-translate-y-1">Sign
            Up Now</a>
        </div>
      </div>
    </div>
  </section>

  <!-- JavaScript for Modern Carousel -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const carousel = document.getElementById('carousel-inner');
      const slides = document.querySelectorAll('.carousel-slide');
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const dotsContainer = document.getElementById('carousel-dots');

      if (!carousel || !slides.length || !prevBtn || !nextBtn || !dotsContainer) return;

      // Remove any existing clones to avoid duplication
      document.querySelectorAll('.carousel-clone').forEach(el => el.remove());

      const totalSlides = slides.length;
      let currentIndex = 0;
      let startX, moveX, initialPosition;
      let dragging = false;

      // Create pagination dots
      for (let i = 0; i < totalSlides; i++) {
        const dot = document.createElement('div');
        dot.classList.add('carousel-dot');
        if (i === 0) dot.classList.add('active');
        dot.addEventListener('click', () => goToSlide(i));
        dotsContainer.appendChild(dot);
      }

      function updateDots() {
        const dots = document.querySelectorAll('.carousel-dot');
        dots.forEach((dot, i) => {
          dot.classList.toggle('active', i === currentIndex);
        });
      }

      // Clone the first and last slides
      const firstSlideClone = slides[0].cloneNode(true);
      firstSlideClone.classList.add('carousel-clone');

      const lastSlideClone = slides[totalSlides - 1].cloneNode(true);
      lastSlideClone.classList.add('carousel-clone');

      // Add clones to the carousel
      carousel.appendChild(firstSlideClone);
      carousel.insertBefore(lastSlideClone, carousel.firstChild);

      // Function to determine how many slides are visible at once based on screen size
      function getVisibleSlideCount() {
        if (window.innerWidth < 640) return 1;  // Mobile
        if (window.innerWidth < 768) return 2;  // Tablet
        return 4; // Desktop
      }

      const visibleSlides = getVisibleSlideCount();

      // Adjust starting position
      currentIndex = 1;
      updateCarousel(false);
      updateActiveSlide();

      // Auto advance every 6 seconds
      let interval = setInterval(() => {
        nextSlide();
      }, 6000);

      // Previous button
      prevBtn.addEventListener('click', () => {
        prevSlide();
        resetInterval();
      });

      // Next button
      nextBtn.addEventListener('click', () => {
        nextSlide();
        resetInterval();
      });

      function prevSlide() {
        currentIndex--;
        updateCarousel(true);
        updateActiveSlide();

        if (currentIndex === 0) {
          // When we reach the clone of the last slide, loop to the real last slide
          setTimeout(() => {
            currentIndex = totalSlides;
            updateCarousel(false);
            updateActiveSlide();
          }, 300);
        }
      }

      function nextSlide() {
        currentIndex++;
        updateCarousel(true);
        updateActiveSlide();

        if (currentIndex === totalSlides + 1) {
          // When we reach the clone of the first slide, loop to the real first slide
          setTimeout(() => {
            currentIndex = 1;
            updateCarousel(false);
            updateActiveSlide();
          }, 300);
        }
      }

      function goToSlide(index) {
        // Adjust for the clone at the beginning
        currentIndex = index + 1;
        updateCarousel(true);
        updateActiveSlide();
        resetInterval();
      }

      function updateActiveSlide() {
        // Update active state for visual effects
        const allSlides = document.querySelectorAll('.carousel-slide');
        allSlides.forEach((slide, index) => {
          slide.classList.remove('active');
        });

        // Account for the cloned slides in the index calculation
        const activeIndex = currentIndex;
        if (activeIndex > 0 && activeIndex <= totalSlides) {
          allSlides[activeIndex].classList.add('active');
          // Update the dots based on the real slide (not the clone)
          updateDots();
        }
      }

      function updateCarousel(withTransition = true) {
        // Enable or disable transition
        carousel.style.transition = withTransition ? 'transform 300ms ease' : 'none';

        // Calculate position
        const slideWidth = 100 / visibleSlides;
        const translateX = -currentIndex * slideWidth;

        carousel.style.transform = `translateX(${translateX}%)`;

        // Update the active dot index (adjusting for clones)
        const realIndex = (currentIndex - 1 + totalSlides) % totalSlides;
        document.querySelectorAll('.carousel-dot').forEach((dot, i) => {
          dot.classList.toggle('active', i === realIndex);
        });
      }

      function resetInterval() {
        clearInterval(interval);
        interval = setInterval(() => {
          nextSlide();
        }, 6000);
      }

      // Touch events for swipe functionality
      carousel.addEventListener('touchstart', dragStart, false);
      carousel.addEventListener('touchend', dragEnd, false);
      carousel.addEventListener('touchmove', drag, false);

      // Mouse events for swipe functionality
      carousel.addEventListener('mousedown', dragStart, false);
      carousel.addEventListener('mouseup', dragEnd, false);
      carousel.addEventListener('mousemove', drag, false);
      carousel.addEventListener('mouseleave', dragEnd, false);

      function dragStart(e) {
        e.preventDefault();
        initialPosition = carousel.getBoundingClientRect().left;

        if (e.type === 'touchstart') {
          startX = e.touches[0].clientX;
        } else {
          startX = e.clientX;
          carousel.style.cursor = 'grabbing';
        }

        dragging = true;
      }

      function drag(e) {
        if (!dragging) return;

        if (e.type === 'touchmove') {
          moveX = e.touches[0].clientX;
        } else {
          moveX = e.clientX;
        }

        const diffX = moveX - startX;
        const containerWidth = carousel.offsetWidth / visibleSlides;
        let percentMove = (diffX / containerWidth) * 100;

        // Add resistance when trying to swipe past first or last slide
        if (currentIndex === 0 && diffX > 0 || currentIndex === totalSlides + 1 && diffX < 0) {
          percentMove = percentMove / 4;
        }

        const currentTranslateX = -currentIndex * (100 / visibleSlides);
        carousel.style.transform = `translateX(${currentTranslateX + percentMove}%)`;
      }

      function dragEnd() {
        if (!dragging) return;
        dragging = false;
        carousel.style.cursor = 'grab';

        const diffX = moveX - startX;
        const threshold = 100; // Minimum drag distance to trigger slide change

        if (diffX > threshold) {
          prevSlide();
        } else if (diffX < -threshold) {
          nextSlide();
        } else {
          // Return to current slide if drag wasn't far enough
          updateCarousel(true);
        }

        resetInterval();
      }

      // Update carousel on window resize
      window.addEventListener('resize', () => {
        const newVisibleSlides = getVisibleSlideCount();
        if (visibleSlides !== newVisibleSlides) {
          updateCarousel(false);
        }
      });
    });
  </script>

  <%- include('partials/footer') %>